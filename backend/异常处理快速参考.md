# åç«¯å¼‚å¸¸å¤„ç†å¿«é€Ÿå‚è€ƒ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å¦‚ä½•åœ¨Serviceä¸­æŠ›å‡ºå¼‚å¸¸

```java
// âœ… æ¨èåšæ³•
import com.cjh.backend.exception.BusinessException;
import com.cjh.backend.exception.ErrorConstants;

public void someMethod() {
    // éªŒè¯æ¡ä»¶
    if (product == null) {
        throw new BusinessException(ErrorConstants.PRODUCT_NOT_EXIST);
    }
    
    // ä¸šåŠ¡é€»è¾‘ç»§ç»­...
}
```

---

## ğŸ“ å¸¸è§ä¸šåŠ¡åœºæ™¯

### åœºæ™¯1: å•†å“æ“ä½œæƒé™éªŒè¯

```java
Product product = productMapper.selectById(productId);
if (product == null || product.getIsDeleted() == 1) {
    throw new BusinessException(ErrorConstants.PRODUCT_NOT_EXIST);
}

// éªŒè¯æƒé™ï¼ˆå–å®¶æ‰èƒ½æ“ä½œè‡ªå·±çš„å•†å“ï¼‰
if (!product.getUserId().equals(userId)) {
    throw new BusinessException(ErrorConstants.PRODUCT_NO_PERMISSION);
}
```

### åœºæ™¯2: è®¢å•çŠ¶æ€æµè½¬éªŒè¯

```java
Orders order = ordersMapper.selectById(orderId);
if (order == null) {
    throw new BusinessException(ErrorConstants.ORDER_NOT_EXIST);
}

// éªŒè¯æƒé™
if (!order.getBuyerId().equals(buyerId)) {
    throw new BusinessException(ErrorConstants.ORDER_NOT_OWNED);
}

// éªŒè¯çŠ¶æ€
if (!order.getOrderStatus().equals(1)) {  // 1=å¾…æ”¯ä»˜
    throw new BusinessException(ErrorConstants.ORDER_STATUS_INVALID);
}
```

### åœºæ™¯3: ç”¨æˆ·è®¤è¯é”™è¯¯

```java
User user = userMapper.selectByUsername(username);
if (user == null || !passwordEncoder.matches(password, user.getPassword())) {
    throw new BusinessException(ErrorConstants.USERNAME_PASSWORD_ERROR);
}

if (user.getStatus() == 0) {  // 0=å†»ç»“
    throw new BusinessException(ErrorConstants.USER_FROZEN);
}
```

### åœºæ™¯4: å‚æ•°éªŒè¯

```java
if (categoryId == null) {
    throw new BusinessException(ErrorConstants.CATEGORY_ID_REQUIRED);
}

if (status == null || (status != 2 && status != 3)) {
    throw new BusinessException(ErrorConstants.PRODUCT_STATUS_INVALID);
}
```

---

## ğŸ“‹ é”™è¯¯å¸¸é‡é€ŸæŸ¥è¡¨

### å•†å“é”™è¯¯
| å¸¸é‡å | ç”¨é€” |
|------|------|
| `PRODUCT_NOT_EXIST` | å•†å“ä¸å­˜åœ¨æˆ–å·²åˆ é™¤ |
| `PRODUCT_NOT_AVAILABLE` | å•†å“ä¸èƒ½è´­ä¹°ï¼ˆéä¸Šæ¶çŠ¶æ€ï¼‰ |
| `PRODUCT_NO_PERMISSION` | ç”¨æˆ·æ— æƒæ“ä½œæ­¤å•†å“ |
| `PRODUCT_STATUS_INVALID` | éæ³•çš„å•†å“çŠ¶æ€å€¼ |
| `PRODUCT_CANNOT_MODIFY` | å½“å‰çŠ¶æ€ä¸‹ä¸èƒ½ä¿®æ”¹ |
| `PRODUCT_CANNOT_DELETE` | å•†å“ä¸èƒ½åˆ é™¤ï¼ˆåœ¨æ¶ï¼‰ |

### è®¢å•é”™è¯¯
| å¸¸é‡å | ç”¨é€” |
|------|------|
| `ORDER_NOT_EXIST` | è®¢å•ä¸å­˜åœ¨ |
| `ORDER_NOT_OWNED` | ç”¨æˆ·æ— æƒæ“ä½œæ­¤è®¢å• |
| `ORDER_STATUS_INVALID` | è®¢å•çŠ¶æ€ä¸ç¬¦åˆé¢„æœŸ |
| `ORDER_CANNOT_CANCEL` | è®¢å•ä¸èƒ½å–æ¶ˆï¼ˆå·²æ”¯ä»˜ç­‰ï¼‰ |
| `CANNOT_BUY_OWN_PRODUCT` | ç”¨æˆ·è´­ä¹°äº†è‡ªå·±çš„å•†å“ |

### ç”¨æˆ·é”™è¯¯
| å¸¸é‡å | ç”¨é€” |
|------|------|
| `USER_NOT_EXIST` | ç”¨æˆ·ä¸å­˜åœ¨ |
| `USERNAME_EXIST` | æ³¨å†Œæ—¶ç”¨æˆ·åå·²è¢«ä½¿ç”¨ |
| `USERNAME_PASSWORD_ERROR` | ç™»å½•ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ |
| `USER_FROZEN` | ç”¨æˆ·è´¦å·è¢«å†»ç»“ |
| `PASSWORD_OLD_ERROR` | ä¿®æ”¹å¯†ç æ—¶åŸå¯†ç é”™è¯¯ |

---

## ğŸ’» æ—¥å¿—ä½¿ç”¨

### æ·»åŠ æ—¥å¿—æ³¨è§£

```java
import lombok.extern.slf4j.Slf4j;

@Slf4j
@Service
public class MyService {
    
    public void doSomething() {
        log.info("æ‰§è¡ŒæŸä¸ªæ“ä½œ");
        log.debug("è°ƒè¯•ä¿¡æ¯");
        log.warn("è­¦å‘Šä¿¡æ¯");
        log.error("é”™è¯¯ä¿¡æ¯", exception);
    }
}
```

### æ—¥å¿—çº§åˆ«

| çº§åˆ« | ç”¨é€” | ç¤ºä¾‹ |
|------|------|------|
| `DEBUG` | è°ƒè¯•ä¿¡æ¯ | `log.debug("TokenéªŒè¯: {}", token)` |
| `INFO` | ä¸€èˆ¬ä¿¡æ¯ | `log.info("ç”¨æˆ·{}ç™»å½•æˆåŠŸ", userId)` |
| `WARN` | è­¦å‘Šä¿¡æ¯ | `log.warn("Tokenå·²è¿‡æœŸ")` |
| `ERROR` | é”™è¯¯ä¿¡æ¯ | `log.error("æ“ä½œå¤±è´¥", e)` |

---

## âŒ å¸¸è§é”™è¯¯æ¨¡å¼

### é”™è¯¯1: ç¡¬ç¼–ç å­—ç¬¦ä¸²
```java
// âŒ ä¸æ¨è
throw new RuntimeException("å•†å“ä¸å­˜åœ¨");

// âœ… æ¨è
throw new BusinessException(ErrorConstants.PRODUCT_NOT_EXIST);
```

### é”™è¯¯2: æ‰“å°è€Œä¸æ˜¯è®°å½•
```java
// âŒ ä¸æ¨è
System.out.println("ç”¨æˆ·ç™»å½•");

// âœ… æ¨è
log.info("ç”¨æˆ·{}ç™»å½•", userId);
```

### é”™è¯¯3: åæ‰å¼‚å¸¸
```java
// âŒ ä¸æ¨è
try {
    // æŸä¸ªæ“ä½œ
} catch (Exception e) {
    // ä»€ä¹ˆéƒ½ä¸åš
}

// âœ… æ¨è
try {
    // æŸä¸ªæ“ä½œ
} catch (Exception e) {
    throw new BusinessException("æ“ä½œå¤±è´¥");
}
```

### é”™è¯¯4: å¼‚å¸¸é“¾ä¸¢å¤±
```java
// âŒ ä¸æ¨è
try {
    // æŸä¸ªæ“ä½œ
} catch (Exception e) {
    throw new RuntimeException("æ“ä½œå¤±è´¥");  // ä¸¢å¤±åŸå§‹å¼‚å¸¸
}

// âœ… æ¨è
try {
    // æŸä¸ªæ“ä½œ
} catch (Exception e) {
    log.error("æ“ä½œå¤±è´¥", e);
    throw new BusinessException("æ“ä½œå¤±è´¥");
}
```

---

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹å®Œæ•´çš„å¼‚å¸¸å †æ ˆ

åœ¨ `application.properties` ä¸­é…ç½®ï¼š
```properties
# å¯ç”¨è¯¦ç»†é”™è¯¯é¡µé¢
server.error.include-message=always
server.error.include-stacktrace=always
```

### æŸ¥çœ‹SQLæ‰§è¡Œ
```properties
# å¯ç”¨MyBatisæ—¥å¿—
mybatis.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl
```

---

## ğŸ“ è·å–å¸®åŠ©

### å¼‚å¸¸å¤„ç†ç›¸å…³æ–‡æ¡£
- è¯¦ç»†æ–‡æ¡£: [å¼‚å¸¸å¤„ç†æ¡†æ¶è¯´æ˜](./å¼‚å¸¸å¤„ç†æ¡†æ¶è¯´æ˜.md)
- è¡¥å……æ€»ç»“: [åç«¯é€»è¾‘è¡¥å……æ€»ç»“](./åç«¯é€»è¾‘è¡¥å……æ€»ç»“.md)

### ä»£ç ç¤ºä¾‹å‚è€ƒ
- AuthServiceImpl - è®¤è¯å¼‚å¸¸å¤„ç†
- OrdersServiceImpl - è®¢å•å¼‚å¸¸å¤„ç†
- ProductServiceImpl - å•†å“å¼‚å¸¸å¤„ç†

---

## âœ… æ£€æŸ¥æ¸…å•

åœ¨æäº¤ä»£ç å‰ï¼Œç¡®ä¿ï¼š

- [ ] æ‰€æœ‰ä¸šåŠ¡å¼‚å¸¸éƒ½ä½¿ç”¨ `BusinessException`
- [ ] æ‰€æœ‰é”™è¯¯ä¿¡æ¯éƒ½ä½¿ç”¨ `ErrorConstants` å¸¸é‡
- [ ] æ²¡æœ‰ä½¿ç”¨ `System.out.println`ï¼Œæ”¹ç”¨æ—¥å¿—
- [ ] å…³é”®æ“ä½œéƒ½æœ‰æ—¥å¿—è®°å½•
- [ ] æƒé™éªŒè¯éƒ½å·²æ·»åŠ 
- [ ] å‚æ•°éªŒè¯éƒ½å·²æ·»åŠ 
- [ ] çŠ¶æ€æµè½¬é€»è¾‘æ¸…æ™°

---

**æœ€åæ›´æ–°**: 2026-01-20
