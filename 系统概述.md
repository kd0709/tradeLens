# 📋 闲置物品慧选平台 - 系统概述

## 1. 系统简介
本系统是一个基于 Spring Boot 3 + Vue 3 的校园/社区闲置物品交易平台。旨在建立一个可信的二手交易环境，支持完整的商品发布、浏览、搜索、下单、支付模拟、发货收货及评价流程。

---

## 2. 核心业务功能

### （1）用户与账号模块
| 功能          | 描述                   | 逻辑要点                    |
| :------------ | :--------------------- | :-------------------------- |
| **注册/登录** | 账号密码注册、JWT 登录 | 密码加密存储、Token自动刷新 |
| **个人信息**  | 修改昵称、头像、邮箱   | 头像上传至对象存储 (OSS)    |
| **收货地址**  | 多地址管理             | 支持增删改查，设置默认地址  |
| **安全中心**  | 修改密码、注销账号     | 敏感操作需二次验证          |

### （2）商品模块 (卖家视角)
| 功能         | 描述                             | 逻辑要点                                 |
| :----------- | :------------------------------- | :--------------------------------------- |
| **发布商品** | 填写标题、描述、价格、分类、成色 | 支持多图上传，初始状态为"待审核"或"上架" |
| **商品管理** | 编辑信息、手动上下架、删除       | 仅"待审核/上架"状态可编辑                |
| **状态流转** | 待审核 → 上架 → 交易中 → 已售    | 交易中锁定库存，不可被其他人购买         |

### （3）商品模块 (买家视角)
| 功能         | 描述                               | 逻辑要点            |
| :----------- | :--------------------------------- | :------------------ |
| **首页推荐** | 最新发布商品瀑布流                 | 分页加载            |
| **分类浏览** | 树形分类检索 (如 数码/手机/iPhone) | 支持多级分类        |
| **高级搜索** | 关键词 + 价格范围 + 成色筛选       | 支持按价格/时间排序 |
| **商品详情** | 展示大图、卖家信息、留言互动       | 记录浏览量          |

### （4）交易模块 (核心闭环)
| 功能          | 描述                        | 逻辑要点                                          |
| :------------ | :-------------------------- | :------------------------------------------------ |
| **购物车**    | 加入购物车、修改数量、结算  | 校验商品状态是否有效                              |
| **提交订单**  | **选择收货地址** → 生成订单 | **扣减库存**，生成地址快照 (防止后续地址修改影响) |
| **支付模拟**  | 模拟第三方支付回调          | 状态流转：待支付 → 待发货                         |
| **发货管理**  | 卖家填写物流单号            | 状态流转：待发货 → 已发货                         |
| **收货评价**  | 买家确认收货并评价          | 状态流转：已发货 → 已完成 → 已评价                |
| **售后/取消** | 取消订单                    | 仅未支付/未发货状态可取消                         |

### （5）互动与信用
| 功能         | 描述                                  |
| :----------- | :------------------------------------ |
| **商品收藏** | 收藏感兴趣的商品，方便后续查看        |
| **交易评价** | 交易完成后对商品/卖家进行打分 (1-5星) |
| **留言提问** | 在商品详情页公开发布提问              |

---

## 3. 技术架构

### 后端
- **核心框架**: Spring Boot 3.x
- **权限安全**: Spring Security + JWT
- **数据库**: MySQL 8.0
- **持久层**: MyBatis-Plus
- **对象存储**: 阿里云 OSS / MinIO
- **工具库**: Hutool, Lombok, Knife4j (接口文档)

### 前端
- **框架**: Vue 3 (Composition API) + TypeScript
- **UI组件**: Element Plus
- **状态管理**: Pinia
- **网络请求**: Axios (封装拦截器)
- **路由**: Vue Router 4

---

## 4. 数据库设计 (Schema)

### 4.1 用户表 `user`
```sql
CREATE TABLE user (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '用户ID',
    username VARCHAR(20) NOT NULL COMMENT '用户名',
    password VARCHAR(255) NOT NULL COMMENT '加密后的密码',
    nickname VARCHAR(50) NOT NULL COMMENT '用户昵称',
    phone VARCHAR(20) COMMENT '手机号',
    email VARCHAR(100) COMMENT '邮箱',
    avatar VARCHAR(255) COMMENT '头像URL',
    status TINYINT DEFAULT 1 COMMENT '账号状态：1正常 0封禁',
    role TINYINT DEFAULT 0 COMMENT '角色：0普通用户 1管理员',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY uk_username (username)
) COMMENT='用户表';
```

### 4.2  收货地址表 `address`

```sql
CREATE TABLE address (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '地址ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    receiver_name VARCHAR(20) NOT NULL COMMENT '收货人姓名',
    receiver_phone VARCHAR(20) NOT NULL COMMENT '收货人电话',
    province VARCHAR(20) NOT NULL COMMENT '省',
    city VARCHAR(20) NOT NULL COMMENT '市',
    district VARCHAR(20) NOT NULL COMMENT '区',
    detail_address VARCHAR(100) NOT NULL COMMENT '详细地址',
    is_default TINYINT DEFAULT 0 COMMENT '是否默认：1是 0否',
    is_deleted TINYINT DEFAULT 0 COMMENT '逻辑删除',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    KEY idx_user (user_id)
) COMMENT='收货地址表';
```

### 4.3 商品分类表 `category`

```sql
CREATE TABLE category (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '分类ID',
    name VARCHAR(50) NOT NULL COMMENT '分类名称',
    parent_id BIGINT DEFAULT NULL COMMENT '父分类ID，NULL表示一级分类',
    level INT NOT NULL COMMENT '分类层级，从1开始',
    path VARCHAR(255) COMMENT '分类路径，如 1/3/8',
    status TINYINT DEFAULT 1 COMMENT '状态：1启用 0禁用',
    create_time DATETIME COMMENT '创建时间',
    UNIQUE KEY uk_parent_name (parent_id, name)
) COMMENT='商品分类表';
```
### 4.4 商品表 `product`

```sql
CREATE TABLE product (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '商品ID',
    user_id BIGINT NOT NULL COMMENT '发布者ID',
    category_id BIGINT NOT NULL COMMENT '分类ID',
    title VARCHAR(100) NOT NULL COMMENT '商品标题',
    description TEXT COMMENT '商品描述',
    price DECIMAL(10,2) NOT NULL COMMENT '商品价格',
    quantity INT DEFAULT 1 COMMENT '商品数量',
    condition_level TINYINT NOT NULL COMMENT '新旧程度：1全新 2几乎全新 3轻微使用 4明显使用',
    negotiable TINYINT DEFAULT 1 COMMENT '是否可议价：1是 0否',
    product_status TINYINT DEFAULT 1 COMMENT '状态：1待审核 2上架 3下架 4已售',
    is_deleted TINYINT DEFAULT 0 COMMENT '逻辑删除：0否 1是',
    view_count INT DEFAULT 0 COMMENT '浏览量',
    create_time DATETIME COMMENT '创建时间',
    update_time DATETIME COMMENT '更新时间',
    KEY idx_user (user_id),
    KEY idx_category (category_id),
    KEY idx_status (product_status)
) COMMENT='商品表';
```

### 4.5 商品图片表 `product_image`

```sql
CREATE TABLE product_image (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '图片ID',
    product_id BIGINT NOT NULL COMMENT '商品ID',
    image_url VARCHAR(255) NOT NULL COMMENT '图片URL',
    is_main TINYINT DEFAULT 0 COMMENT '是否主图：1是 0否',
    sort INT DEFAULT 0 COMMENT '排序值，越小越靠前',
    create_time DATETIME COMMENT '创建时间',
    KEY idx_product (product_id)
) COMMENT='商品图片表';
```
### 4.6 购物车表 `cart`

```sql
CREATE TABLE cart (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '购物车ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    product_id BIGINT NOT NULL COMMENT '商品ID',
    quantity INT DEFAULT 1 COMMENT '商品数量',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_user_product (user_id, product_id),
    KEY idx_user (user_id)
) COMMENT='购物车表';
```
### 4.7 订单表 `orders`

```sql
CREATE TABLE orders (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '订单ID',
    order_no VARCHAR(50) NOT NULL COMMENT '订单编号',
    buyer_id BIGINT NOT NULL COMMENT '买家ID',
    seller_id BIGINT NOT NULL COMMENT '卖家ID',
    total_price DECIMAL(10,2) NOT NULL COMMENT '订单总价',
    status TINYINT DEFAULT 1 COMMENT '状态：1待支付 2待发货 3已发货 4已完成 5已取消',
    receiver_name VARCHAR(20) NOT NULL COMMENT '收货人快照',
    receiver_phone VARCHAR(20) NOT NULL COMMENT '电话快照',
    receiver_address VARCHAR(255) NOT NULL COMMENT '完整地址快照',
    tracking_no VARCHAR(50) COMMENT '物流单号',
    
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    pay_time DATETIME COMMENT '支付时间',
    delivery_time DATETIME COMMENT '发货时间',
    finish_time DATETIME COMMENT '完成时间',
    UNIQUE KEY uk_order_no (order_no),
    KEY idx_buyer (buyer_id),
    KEY idx_seller (seller_id)
) COMMENT='订单表';
```

## 4.8 订单明细表 `order_item`

```sql
CREATE TABLE order_item (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '明细ID',
    order_id BIGINT NOT NULL COMMENT '订单ID',
    product_id BIGINT NOT NULL COMMENT '商品ID',
    product_title VARCHAR(100) NOT NULL COMMENT '商品标题（下单时快照）',
    price DECIMAL(10,2) NOT NULL COMMENT '成交单价',
    quantity INT NOT NULL COMMENT '购买数量',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    KEY idx_order (order_id)
) COMMENT='订单明细表';
```

## 4.9 商品评价表 `comment`

```sql
CREATE TABLE comment (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '评价ID',
    user_id BIGINT NOT NULL COMMENT '评价用户ID',
    product_id BIGINT NOT NULL COMMENT '商品ID',
    order_id BIGINT NOT NULL COMMENT '订单ID',
    score TINYINT NOT NULL COMMENT '评分：1-5',
    content VARCHAR(255) COMMENT '评价内容',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    UNIQUE KEY uk_order (order_id),
    KEY idx_product (product_id)
) COMMENT='商品评价表';
```

## 4.10 收藏表 `favorite`

```sql
CREATE TABLE favorite (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '收藏ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    product_id BIGINT NOT NULL COMMENT '商品ID',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    UNIQUE KEY uk_user_product (user_id, product_id),
    KEY idx_user (user_id)
) COMMENT='商品收藏表';
```

